<project name="CDK Website Build File" default="website" basedir=".">

  <property name="build.dir" value="../target"/>

  <target id="layout" name="layout" depends="includes">
    <xslt in="layout.xml" out="autolayout.xml" style="xsl/autolayout.xsl"/>
  </target>

  <target name="website-from-autolayout" depends="layout">
    <!-- does should work, but it doesn't -->
    <xslt in="autolayout.xml" destdir="${build.dir}/" style="xsl/tabular.xsl"/>
  </target>

  <target id="clean" name="clean">
    <delete file="javancss-tmp.xml"/>
    <delete file="javancss-data.xml"/>
    <delete file="javadoc-data.xml"/>
    <delete file="autolayout.xml"/>
    <delete>
      <fileset dir="${build.dir}/" includes="*.html"/>
    </delete>
  </target>
  
  <target name="check.includes" id="check.includes">
    <uptodate property="javancss.uptodate"
      targetfile="javancss-data.xml">
      <srcfiles dir="../../.." includes="CHANGELOG"/>
    </uptodate>
    <echo message="Java source stats uptodate: ${javancss.uptodate}"/>
    <uptodate property="keywordindex.uptodate"
      targetfile="../../javadoc/keyword.index.xml">
      <srcfiles dir="../../.." includes="CHANGELOG"/>
    </uptodate>
    <echo message="Keyword index uptodate: ${keywordindex.uptodate}"/>
    <uptodate property="refs.uptodate"
      targetfile="../../refs/cheminf.dbx">
      <srcfiles dir="../../refs" includes="cheminf.btx"/>
    </uptodate>
    <echo message="Bibliography index uptodate: ${refs.uptodate}"/>
  </target>

  <target name="includes" id="includes" 
      depends="check.includes, javancss, keyword.index, bibliography"/>
  
  <target id="website" name="website" depends="layout">
    <xslt basedir="." destdir="${build.dir}" extension=".html"
      includes="*.xml" excludes="build.xml, *layout.xml, java*-data.xml, javancss-tmp.xml, keyword.index.xml"
      style="xsl/tabular.xsl"/>
  </target>

  <target name="javancss" unless="javancss.uptodate">
    <java classname="javancss.Main" fork="yes"
      output="javancss-tmp.xml">
      <arg value="-package"/>
      <arg value="-xml"/>
      <arg value="-recursive"/>
      <arg value="../../../src"/>
      <classpath>
        <pathelement location="javancss/lib/javancss.jar"/>
        <pathelement location="javancss/lib/ccl.jar"/>
        <pathelement location="javancss/lib/jhbasic.jar"/>
      </classpath>
    </java>
    <xslt in="javancss-tmp.xml" out="javancss-data.xml" style="xsl/javancss2docbook.xsl"/>
    <xslt in="javancss-tmp.xml" out="javadoc-data.xml" style="xsl/javancss2docbook-javadoc.xsl"/>
  </target>
  
  <target id="keyword.index" name="keyword.index" unless="keywordindex.uptodate">
    <ant dir="../../javadoc/" antfile="build.xml" target="keyword.index"/>
  </target>

  <target id="bibliography" name="bibliography" unless="refs.uptodate">
    <ant dir="../../refs/" antfile="build.xml" target="convertToDocBook" />
  </target>

</project>
