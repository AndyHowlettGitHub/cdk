<project name="CDK" default="html" basedir=".">

    <property file="build.props"/>

    <!-- $Id$ -->

    <property name="javadoc.dir" value="doc/api" />
    <property name="pathtojava3d" value="" />
    <property name="build" value="build" />
    <property name="src" value="src" />

    <path id="project.class.path">
        <pathelement location="." />
        <fileset dir="jar">
            <include name="*.jar" />
        </fileset>
        <fileset dir="jar/libio">
            <include name="*.jar" />
        </fileset>
        <fileset dir="${pathtojava3d}">
            <include name="*.jar" />
        </fileset>
    </path>

    <target name="doccheck-all" depends="doccheck-core, doccheck-standard, doccheck-io, doccheck-render, doccheck-extra, doccheck-qsar"/>
    
    <target name="html" depends="compileTaglets">
        <mkdir dir="${javadoc.dir}" />

        <!-- Call javacc target in build.xml to re-generate the source code -->
        <ant antfile="build.xml" target="javacc"/>

        <javadoc destdir="${javadoc.dir}"
                 author="true" version="true" use="true"
                 public="true"
                 windowtitle="CDK API - version ${version}">
            <classpath refid="project.class.path" />
            <tag name="cdk.keyword" scope="all" description="Keywords:" />
            <tag name="cdk.created" scope="all" description="Created on:" />
            <tag name="cdk.require" scope="all" description="Requires:" />
            <tag name="cdk.depends" scope="all" description="Required library to be able to run this class:" />
            <tag name="cdk.builddepends" scope="all" description="Required library to be able to compile this class:" />
            <taglet name="CDKModuleTaglet" path="doc/javadoc" />
            <taglet name="CDKCiteTaglet" path="doc/javadoc" />
            <packageset dir="${src}" defaultexcludes="yes">
                <include name="org/openscience/cdk/**" />
                <exclude name="org/openscience/cdk/test/**"/>
            </packageset>
        </javadoc>
    </target>

  <target name="jjdoc" description="Create JJDoc documentation from the .jj file">   
    <mkdir dir="doc/iupac-parser"/>
    <jjdoc target="${src}/org/openscience/cdk/iupac/parser/NomParser.jj"
      outputfile="doc/iupac-parser/ParserBNF.html"
      javacchome="jar"/>
  </target>

    <!-- The doclet used in the following targets cannot be put in CVS because it is 
         licensed otherwise, but it can be downloaded from:
         
         http://java.sun.com/j2se/javadoc/doccheck/
         
      -->
          
    <target name="doccheck">
        <mkdir dir="reports/doccheck"/>
        <javadoc private="false" public="true"
                 destdir="reports/doccheck/"
                 excludepackagenames="org.openscience.cdk.test.*">
            <classpath refid="project.class.path" />

            <doclet name="com.sun.tools.doclets.doccheck.DocCheck"
                    path="jar/doccheck.jar" />
            <package name="org.openscience.cdk"/>
            <sourcepath>
                <pathelement path="${src}"/>
            </sourcepath>
        </javadoc>
    </target>

    <target name="doccheck-core">
        <mkdir dir="reports/javadoc/core/"/>
        <javadoc private="false" public="true"
                 destdir="reports/javadoc/core/"
                 excludepackagenames="org.openscience.cdk.test.*">
            <classpath refid="project.class.path" />

            <doclet name="com.sun.tools.doclets.doccheck.DocCheck"
                    path="jar/doccheck.jar" />
            <fileset dir="${src}">
                <includesfile name="${src}/core.javafiles"/>
            </fileset>
            <sourcepath>
                <pathelement path="${src}"/>
            </sourcepath>
        </javadoc>
    </target>

    <target name="doccheck-standard">
        <mkdir dir="reports/javadoc/standard/"/>
        <javadoc private="false" public="true"
                 destdir="reports/javadoc/standard/"
                 excludepackagenames="org.openscience.cdk.test.*">
            <classpath refid="project.class.path" />

            <doclet name="com.sun.tools.doclets.doccheck.DocCheck"
                    path="jar/doccheck.jar" />
            <fileset dir="${src}">
                <includesfile name="${src}/standard.javafiles"/>
            </fileset>
            <sourcepath>
                <pathelement path="${src}"/>
            </sourcepath>
        </javadoc>
    </target>

    <target name="doccheck-io">
        <mkdir dir="reports/javadoc/io/"/>
        <javadoc private="false" public="true"
                 destdir="reports/javadoc/io/"
                 excludepackagenames="org.openscience.cdk.test.*">
            <classpath refid="project.class.path" />

            <doclet name="com.sun.tools.doclets.doccheck.DocCheck"
                    path="jar/doccheck.jar" />
            <fileset dir="${src}">
                <includesfile name="${src}/io.javafiles"/>
            </fileset>
            <sourcepath>
                <pathelement path="${src}"/>
            </sourcepath>
        </javadoc>
    </target>

    <target name="doccheck-render">
        <mkdir dir="reports/javadoc/render/"/>
        <javadoc private="false" public="true"
                 destdir="reports/javadoc/render/"
                 excludepackagenames="org.openscience.cdk.test.*">
            <classpath refid="project.class.path" />

            <doclet name="com.sun.tools.doclets.doccheck.DocCheck"
                    path="jar/doccheck.jar" />
            <fileset dir="${src}">
                <includesfile name="${src}/render.javafiles"/>
            </fileset>
            <sourcepath>
                <pathelement path="${src}"/>
            </sourcepath>
        </javadoc>
    </target>

    <target name="doccheck-extra">
        <mkdir dir="reports/javadoc/extra/"/>
        <javadoc private="false" public="true"
                 destdir="reports/javadoc/extra/"
                 excludepackagenames="org.openscience.cdk.test.*">
            <classpath refid="project.class.path" />

            <doclet name="com.sun.tools.doclets.doccheck.DocCheck"
                    path="jar/doccheck.jar" />
            <fileset dir="${src}">
                <includesfile name="${src}/extra.javafiles"/>
            </fileset>
            <sourcepath>
                <pathelement path="${src}"/>
            </sourcepath>
        </javadoc>
    </target>

   <target name="doccheck-qsar">
        <mkdir dir="reports/javadoc/qsar/"/>
        <javadoc private="false" public="true"
                 destdir="reports/javadoc/qsar/"
                 excludepackagenames="org.openscience.cdk.test.*">
            <classpath refid="project.class.path" />

            <doclet name="com.sun.tools.doclets.doccheck.DocCheck"
                    path="jar/doccheck.jar" />
            <fileset dir="${src}">
                <includesfile name="${src}/qsar.javafiles"/>
            </fileset>
            <sourcepath>
                <pathelement path="${src}"/>
            </sourcepath>
        </javadoc>
    </target>

   <target name="doccheck-builder3d">
        <mkdir dir="reports/javadoc/builder3d/"/>
        <javadoc private="false" public="true"
                 destdir="reports/javadoc/builder3d/"
                 excludepackagenames="org.openscience.cdk.test.*">
            <classpath refid="project.class.path" />

            <doclet name="com.sun.tools.doclets.doccheck.DocCheck"
                    path="jar/doccheck.jar" />
            <fileset dir="${src}">
                <includesfile name="${src}/builder3d.javafiles"/>
            </fileset>
            <sourcepath>
                <pathelement path="${src}"/>
            </sourcepath>
        </javadoc>
    </target>

  <target id="check" name="check">
    <condition property="isMacOsX">
      <and>
        <os family="mac"/>
        <os family="unix"/>
      </and>
    </condition>
  </target>

  <target name="compileTaglets" id="compileTaglets" depends="check, compileTaglets.MacOSX, compileTaglets.Other" />

  <target name="compileTaglets.MacOSX" id="compileTaglets.MacOSX" if="isMacOsX">
    <javac srcdir="doc/javadoc/source" destdir="doc/javadoc"
           includes="*Taglet.java" debug="on" optimize="off"/>
  </target>

  <target name="compileTaglets.Other" id="compileTaglets.Other" unless="isMacOsX">
    <javac srcdir="doc/javadoc/source" destdir="doc/javadoc" 
         includes="*Taglet.java" debug="on" optimize="off">
      <classpath>
        <fileset dir="${java.ext.dirs}">
          <include name="tools.jar" />
        </fileset>
        <fileset dir="${java.ext.dirs}/../../../lib">
          <include name="tools.jar" />
        </fileset>
      </classpath>
    </javac>
  </target>

</project>



