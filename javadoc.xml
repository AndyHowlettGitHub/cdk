<project name="CDK" default="html" basedir=".">

    <property file="build.props"/>

    <!-- $Id$ -->

    <property name="vecmath.src" value="gcj/vecmath" />
    <property name="vecmath.javadoc.dir" value="doc/vecmath/api" />

    <property name="src" value="src" />
    <property name="javadoc.dir" value="doc/cdk-javadoc-${version}" />
    <property name="doxygen.dir" value="doc/doxygen" />

    <property name="pathtojava3d" value="" />
    <property name="build" value="build" />

    <path id="project.class.path">
        <pathelement location="." />
        <fileset dir="jar">
            <include name="*.jar" />
        </fileset>
        <fileset dir="${pathtojava3d}">
            <include name="*.jar" />
        </fileset>
    </path>

    <taskdef name="doxygen" classname="org.doxygen.tools.DoxygenTask"
            classpath="develjar/ant_doxygen.jar" />

    <target name="doxygen" id="doxygen">
        <mkdir dir="${doxygen.dir}" />
        <doxygen>
            <property name="INPUT" value="src/" />
            <property name="PROJECT_NAME" value="The Chemistry Development Kit" />
            <property name="OUTPUT_DIRECTORY" value="${doxygen.dir}" />
            <property name="OPTIMIZE_OUTPUT_JAVA" value="YES" />
            <property name="UML_LOOK" value="YES" />
            <property name="ALIASES" value='"cdk.module=Is part of the CDK module:"' />
        </doxygen>
    </target>

    <target name="html" depends="compileTaglets">
        <mkdir dir="${javadoc.dir}" />

        <!-- Call javacc target in build.xml to re-generate the source code -->
        <ant antfile="build.xml" target="javacc"/>
   <tstamp>
                <format property="TODAY_SVN" pattern="yyyyMMdd" locale="en" />
            </tstamp>
        <javadoc destdir="${javadoc.dir}"
                 author="true" version="true" use="true"
                 public="true"
                 windowtitle="CDK API - version ${TODAY_SVN}">
            <classpath>
                <pathelement location="." />
                <fileset dir="jar">
                    <include name="*.jar" />
                </fileset>
                 <dirset dir="src/main">
                     <include name="net/**/*"/>
                 </dirset>
            </classpath>
            <tag name="cdk.set" scope="all" description="Belongs to the set:" />
            <tag name="cdk.keyword" scope="all" description="Keywords:" />
            <tag name="cdk.created" scope="all" description="Created on:" />
            <tag name="cdk.require" scope="all" description="Requires:" />
            <tag name="cdk.depends" scope="all" description="Required library to be able to run this class:" />
            <tag name="cdk.builddepends" scope="all" description="Required library to be able to compile this class:" />
            <tag name="cdk.todo" scope="all" description="To do:" />
            <tag name="cdk.license" scope="all" description="License:" />
            <taglet name="net.sf.cdk.tools.doclets.CDKCiteTaglet" path="jar/xom-1.1.jar:src/main" />
            <taglet name="net.sf.cdk.tools.doclets.CDKModuleTaglet" path="jar/xom-1.1.jar:src/main" />
            <taglet name="net.sf.cdk.tools.doclets.CDKBugTaglet" path="jar/xom-1.1.jar:src/main" />
            <taglet name="net.sf.cdk.tools.doclets.CDKDictRefTaglet" path="jar/xom-1.1.jar:src/main" />
            <taglet name="net.sf.cdk.tools.doclets.CDKInChITaglet" path="jar/xom-1.1.jar:src/main" />
            <taglet name="net.sf.cdk.tools.doclets.CDKThreadSafeTaglet" path="jar/xom-1.1.jar:src/main" />
            <taglet name="net.sf.cdk.tools.doclets.CDKThreadNonSafeTaglet" path="jar/xom-1.1.jar:src/main" />
            <taglet name="net.sf.cdk.tools.doclets.CDKGitTaglet" path="jar/xom-1.1.jar:src/main" />
            <packageset dir="${src}/main" defaultexcludes="yes">
                <include name="org/openscience/cdk/**" />
            </packageset>
        </javadoc>
    </target>

    <target name="vecmath.html">
        <mkdir dir="${vecmath.javadoc.dir}" />

        <javadoc destdir="${vecmath.javadoc.dir}"
                 author="true" version="true" use="true"
                 public="true"
                 windowtitle="VecMath API">
            <classpath refid="project.class.path" />
            <packageset dir="${vecmath.src}" defaultexcludes="yes">
                <include name="javax/vecmath/**" />
            </packageset>
        </javadoc>
    </target>

  <target name="jjdoc" description="Create JJDoc documentation from the .jj file">   
    <mkdir dir="doc/iupac-parser"/>
    <jjdoc target="${src}/main/org/openscience/cdk/iupac/parser/NomParser.jj"
      outputfile="doc/iupac-parser/ParserBNF.html"
      javacchome="jar"/>
  </target>

  <target id="check" name="check">
    <condition property="isMacOsX">
      <and>
        <os family="mac"/>
        <os family="unix"/>
      </and>
    </condition>
  </target>

  <target name="compileTaglets" id="compileTaglets" depends="check, compileTaglets.MacOSX, compileTaglets.Other" />

  <target name="compileTaglets.MacOSX" id="compileTaglets.MacOSX" if="isMacOsX">
    <javac srcdir="src" destdir="src"
           includes="*Taglet.java" debug="on" optimize="off"/>
  </target>

  <target name="compileTaglets.Other" id="compileTaglets.Other" unless="isMacOsX">
    <javac srcdir="src/main" destdir="src/main"
         includes="net/sf/cdk/tools/**/*.java" debug="on" optimize="off">
      <classpath>
        <fileset dir="jar/">
          <include name="xom-1.1.jar" />
        </fileset>
      </classpath>
    </javac>
  </target>

</project>



