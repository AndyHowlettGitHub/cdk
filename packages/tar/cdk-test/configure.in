dnl
dnl $Id$
dnl
AC_INIT()
AM_INIT_AUTOMAKE(cdk-bin, `cat VERSION`)

dnl deal with options
AC_ARG_WITH(xercesdir,
      [  --with-xercesdir=DIR  where to find the xerces.jar library
                               [/usr/share/java] ],
      [  if test -n "$withval"
         then
          XERCESDIR="$withval"
         fi]
)
dnl set default
if test -z "$XERCESDIR"
then
    XERCESDIR="/usr/share/java"
fi
AC_SUBST(XERCESDIR)

AC_ARG_WITH(log4javadir,
      [  --with-log4javadir=DIR  where to find the log4j.jar and log4j-core.jar libraries
                               [/usr/share/java] ],
      [  if test -n "$withval"
         then
          LOGJAVADIR="$withval"
         fi]
)
dnl set default
if test -z "$LOGJAVADIR"
then
    LOGJAVADIR="/usr/share/java"
fi
AC_SUBST(LOGJAVADIR)

AC_ARG_WITH(java3ddir,
      [  --with-java3ddir=DIR    path to the Java 3D installation directory
        ],
      [  if test -n "$withval"
         then
          JAVA3DDIR="$withval"
         fi
        ])

dnl Checks for programs.
AC_PROG_INSTALL
AC_PROG_LN_S
AC_PROG_MAKE_SET

AC_MSG_CHECKING(for CDK libraries)
if test -f "$prefix/lib/cdk/dadml.jar"
then
    CDKLIBDIR="$prefix"
    AC_MSG_RESULT($CDKLIBDIR)
else
    AC_MSG_RESULT(no)
	echo "The required libraries for CDK are not installed. Please download and install"
	echo "the cdk-libs distribution."
    exit 1
fi

AC_MSG_CHECKING(for CDK binary)
if test -f "$prefix/lib/cdk/dadml.jar"
then
    CDKLIBDIR="$prefix"
    AC_MSG_RESULT($CDKLIBDIR)
else
    AC_MSG_RESULT(no)
        echo "The required CDK binary is not installed. Please download and install"
        echo "the cdk-bin distribution."
    exit 1
fi

AC_CHECK_PROG(HASJAVA, java, yes, no)
if test "xyes" = "x$HASJAVA"
then
        AC_PATH_PROG(PATHTOJAVA, java, no)
fi

AC_MSG_CHECKING(for rt.jar lib)
for d in "/usr/lib/j2re1.3/lib"
do
    if test -f "$d/rt.jar"
    then
        PATHTORTJAR="$d/rt.jar"
    fi
done
if test "x$PATHTORTJAR" = "x"
then
    AC_MSG_RESULT(no)
else
    AC_MSG_RESULT($PATHTORTJAR)
fi
AC_SUBST(PATHTORTJAR)

AC_MSG_CHECKING(for Java3D lib)
if test -f "$JAVA3DDIR/lib/ext/j3dcore.jar"
    AC_MSG_RESULT($JAVA3DDIR/lib/ext/j3dcore.jar)
    PATHTO3DJAR="$JAVA3DDIR/lib/ext/j3dcore.jar:$JAVA3DDIR/lib/ext/j3dutils.jar:$JAVA3DDIR/lib/ext/vecmath.jar"
then
    if test "x$prefix" = xNONE
    then
        # order these with prefered one at the end
        try_dirs="$ac_default_prefix"
    else
        try_dirs="$prefix"
    fi

    # Debian GNU/Linux Blackdown path
    try_dirs="$try_dirs /usr/lib/j2re1.3"

    for d in $try_dirs
    do
        if test -f "$d/j3dcore.jar"
        then 
            AC_MSG_RESULT($d/j3dcore.jar)
            PATHTO3DJAR="$d/j3dcore.jar:$d/j3dutils.jar:$d/vecmath.jar"
        fi
    done
fi
AC_SUBST(PATHTO3DJAR)

AC_MSG_CHECKING(for log4j.jar lib)
for d in "$LOGJAVADIR" "$prefix/lib/cdk"
do
    if test -f "$d/log4j.jar"
    then
        PATHTOLOGJAVA="$d/log4j.jar:$d/log4j-core.jar"
    fi
done
if test "x$PATHTOLOGJAVA" = "x"
then
    AC_MSG_RESULT(no)
else
    AC_MSG_RESULT($PATHTOLOGJAVA)
fi
AC_SUBST(PATHTOLOGJAVA)

AC_MSG_CHECKING(for xerces.jar lib)
PATHTOXERCES=""
for d in "$XERCESDIR" "$prefix/lib/cdk"
do
    for f in "xerces.jar" "xerces-1.3.0.jar"
    do
        if test -f "$d/$f"
        then
            PATHTOXERCES="$d/$f"
        fi
    done
done
if test "x$PATHTOXERCES" = "x"
then
    AC_MSG_RESULT(no)
else
    AC_MSG_RESULT($PATHTOXERCES)
fi
AC_SUBST(PATHTOXERCES)

dnl needed for check_xml
AC_PATH_PROGS(PATHTONSGMLS, onsgmls nsgmls, no)

AC_OUTPUT([
   Makefile
   bin/Makefile
   bin/cdk-test
   jar/Makefile
])

