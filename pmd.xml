<?xml version="1.0"?>
<project name="CDK" default="pmd" basedir=".">

    <property name="lib" value="develjar" />
    <property name="build" value="build" />
    <property name="src" value="src" />
    <property name="reports.tests" value="reports" />

    <path id="pmd.classpath">
        <pathelement location="${build}"/>
        <fileset dir="${lib}">
          <include name="jakarta-oro-2.0.8.jar"/>
          <include name="pmd-3.6.jar"/>
          <include name="jaxen-1.1-beta-7.jar"/>
        </fileset>
    </path>

    <target name="compileRenderer" id="compileRenderer">
        <javac srcdir="pmd" destdir="${build}"
               includes="net/sourceforge/pmd/renderers/SummaryVBHTMLRenderer.java">
            <classpath refid="pmd.classpath" />
        </javac>
    </target>

    <taskdef name="pmd" id="pmd">
      <!-- the data classes modules -->
      <antcall target="test-module"><param name="pmd.test" value="custom-data"/><param name="module" value="data"/></antcall>
      <antcall target="test-module"><param name="pmd.test" value="custom-data"/><param name="module" value="datadebug"/></antcall>
      <antcall target="test-module"><param name="pmd.test" value="custom-data"/><param name="module" value="nonotify"/></antcall>
      <!-- the other modules -->
      <antcall target="test-module"><param name="pmd.test" value="custom"/><param name="module" value="interfaces"/></antcall>
      <antcall target="test-module"><param name="pmd.test" value="custom"/><param name="module" value="core"/></antcall>
      <antcall target="test-module"><param name="pmd.test" value="custom"/><param name="module" value="standard"/></antcall>
      <antcall target="test-module"><param name="pmd.test" value="custom"/><param name="module" value="io"/></antcall>
      <antcall target="test-module"><param name="pmd.test" value="custom"/><param name="module" value="io-jmol"/></antcall>
      <antcall target="test-module"><param name="pmd.test" value="custom"/><param name="module" value="extra"/></antcall>
      <antcall target="test-module"><param name="pmd.test" value="custom"/><param name="module" value="render"/></antcall>
      <antcall target="test-module"><param name="pmd.test" value="custom"/><param name="module" value="libio-cml"/></antcall>
      <antcall target="test-module"><param name="pmd.test" value="custom"/><param name="module" value="libio-joelib"/></antcall>
      <antcall target="test-module"><param name="pmd.test" value="custom"/><param name="module" value="libio-biojava"/></antcall>
      <antcall target="test-module"><param name="pmd.test" value="custom"/><param name="module" value="builder3d"/></antcall>
      <antcall target="test-module"><param name="pmd.test" value="custom"/><param name="module" value="smiles"/></antcall>
      <antcall target="test-module"><param name="pmd.test" value="custom"/><param name="module" value="forcefield"/></antcall>
      <antcall target="test-module"><param name="pmd.test" value="custom"/><param name="module" value="qsar"/></antcall>
      <antcall target="test-module"><param name="pmd.test" value="custom"/><param name="module" value="experimental"/></antcall>
      <antcall target="test-module"><param name="pmd.test" value="custom"/><param name="module" value="svg"/></antcall>
      <antcall target="test-module"><param name="pmd.test" value="custom"/><param name="module" value="valencycheck"/></antcall>
    </target>

    <target id="test-module" name="test-module"
            description="Performs a PMD checks for the given CDK module.">

      <echo message="Running PMD checks for CDK's ${module} module." />

      <mkdir dir="${reports.tests}/pmd"/>
      <pmd shortFilenames="true" rulesetfiles="pmd/${pmd.test}.xml">
        <formatter type="html" toFile="${reports.tests}/pmd/${module}.html"/>
        <fileset dir="${src}">
          <includesfile name="${src}/${module}.javafiles"/>
        </fileset>
      </pmd>
    </target>

</project>
