<project name="JmolCDK" default="dist-both" basedir=".">

  <!-- compile options -->
  <!-- mth 2003-05-07 had problems with this directive
  <property name="build.compiler" value="javac1.1" />
  -->
  <property name="debug" value="on" />
  <property name="deprecation" value="on" />
  <property name="optimization" value="off" />
  
  <!-- directories -->
  <property name="build" value="build" />
  <property name="sourcedist" value="sourcedist" />
  <property name="dist" value="dist" />
  <property name="doc" value="doc" />
  <property name="src" value="src" />
  <property name="build.src" value="${build}/${src}" />
  <property name="lib" value="jar" />
  <property name="src.tests" value="${src}/org/openscience/cdk/test" />
  <property name="reports.tests" value="reports" />

  <path id="project.class.path">
    <fileset dir="${lib}">
      <include name="*.jar" />
    </fileset>
    <fileset dir="${lib}/libio">
      <include name="jmol.jar" />
    </fileset>
  </path>

  <target name="init">
    <ant antfile="build.xml" target="clean"/>
    <ant antfile="build.xml" target="init"/>
  </target>  
    
  <target name="compile-applet">

    <patch patchfile="${src}/patches/org.openscience.cdk.toold.LoggingTool.java.MakeUsableInJmolApplet"
           originalfile="${build.src}/org/openscience/cdk/tools/LoggingTool.java"
           dir="${build.src}/org/openscience/cdk/tools"/>
    <patch patchfile="${src}/patches/org.openscience.cdk.tools.AtomTypeFactory-noFileCheck"
           originalfile="${build.src}/org/openscience/cdk/tools/AtomTypeFactory.java"
           dir="${build.src}/org/openscience/cdk/tools"/>

    <!-- do them one by one, compile-extra, compile-io require 1.4 -->
    <javac srcdir="${build.src}" destdir="${build}" optimize="${optimization}" 
           debug="${debug}" deprecation="${deprecation}" target="1.1"
           includesfile="${src}/jmol.javafiles">
      <classpath refid="project.class.path" />
    </javac>
  </target>

  <target name="compile">

    <!-- do them one by one, compile-extra, compile-io requires 1.4 -->
    <javac srcdir="${build.src}" destdir="${build}" optimize="${optimization}" 
           debug="${debug}" deprecation="${deprecation}" target="1.1"
           includesfile="${src}/jmol.javafiles">
      <classpath refid="project.class.path" />
    </javac>
  </target>

  <target name="dist" depends="compile">
    <ant antfile="build.xml" target="dist.init"/>
    
    <copy file="${src}/jmol.javafiles" tofile="${src}/jmol.classes"/>
    <replace file="${src}/jmol.classes" token=".java" value=".class"/>

    <jar jarfile="${dist}/jar/jmolcdk.jar">
      <fileset dir="${build}">
        <!-- Put only required class files in the jar -->
        <include name="**/*.class" />
      </fileset>
      <fileset dir="${build.src}">
        <!-- These config and data files are also needed -->
        <include name="**/jmol_atomtypes.txt" />
        <include name="org/openscience/cdk/io/cml/data/**" />
        <include name="org/openscience/cdk/config/log4j.properties" />
        <include name="org/openscience/cdk/config/isotopes.xml" />
      </fileset>
    </jar>
  </target>

  <target name="dist-applet" depends="compile-applet">
    <ant antfile="build.xml" target="dist.init"/>
    
    <copy file="${src}/jmol.javafiles" tofile="${src}/jmol.classes"/>
    <replace file="${src}/jmol.classes" token=".java" value=".class"/>

    <jar jarfile="${dist}/jar/jmolappletcdk.jar">
      <fileset dir="${build}">
        <!-- Put only required class files in the jar -->
        <include name="**/*.class" />
      </fileset>
      <fileset dir="${build.src}">
        <!-- These config and data files are also needed -->
        <include name="**/jmol_atomtypes.txt" />
        <include name="org/openscience/cdk/io/cml/data/**" />
        <include name="org/openscience/cdk/config/log4j.properties" />
        <include name="org/openscience/cdk/config/isotopes.xml" />
      </fileset>
    </jar>
  </target>
  
  <target name="dist-both" depends="init, dist, dist-applet"/>
  
</project>
